---
title: 合成事件
description: React的合成事件
---

React 合成事件是指将原生事件合成一个 React 事件，之所以要封装自己的一套事件机制，目的是为了实现全浏览器的一致性，抹平不同浏览器之间的差异性。

![alt 图片](./images/eventflow.svg)

所谓事件流包括三个阶段：事件捕获、目标阶段和事件冒泡。事件捕获是从外到里，对应图中的红色箭头标注部分 window -> document -> html ... -> target，目标阶段是事件真正发生并处理的阶段，事件冒泡是从里到外，对应图中的 target -> ... -> html -> document -> window。 React 合成事件的工作原理大致可以分为两个阶段：

1. 事件绑定
2. 事件触发

在 React17 之前，React 是把事件委托在 document 上的，React17 及以后版本不再把事件委托在 document 上，而是委托在挂载的容器上了  
当真实的 dom 触发事件时，此时构造 React 合成事件对象，按照冒泡或者捕获的路径去收集真正的事件处理函数，在此过程中会先处理原生事件，然后当冒泡到 document 对象后，再处理 React 事件。

React 的合成事件是 React 在事件处理上的一种封装机制，它是为了提供更一致的跨浏览器事件处理方式而设计的。

合成事件的工作原理如下：

1. 事件注册：在 React 组件中，你可以通过 JSX 的语法为元素添加事件处理函数，例如 `<button onClick={handleClick}>Click me</button>`。

2. 事件委托：当元素上触发了事件，React 并不直接将原生事件绑定到元素上，而是在顶层进行事件委托。React 会将所有的事件委托到一个共享的根节点上（通常是 document），以便管理事件的注册和触发。

3. 合成事件对象：当事件触发时，React 会根据事件类型创建一个合成事件对象，并将它传递给事件处理函数。合成事件对象是一个跨浏览器的、封装了原生事件的 JavaScript 对象。它提供了一致的接口，使得在不同浏览器和环境下处理事件变得更加统一。

4. 事件处理函数执行：在事件处理函数中，你可以访问合成事件对象，并在其中获取事件的相关信息，如事件类型、目标元素、键盘状态、鼠标位置等。

5. 事件池与事件回收：为了提高性能，React 使用了事件池（Event Pool）的概念，即复用合成事件对象。在事件处理函数执行完毕后，合成事件对象会被重置，并返回到事件池中供下一次事件使用，而不是立即销毁。

通过使用合成事件，React 提供了一种更高级、更一致的事件处理机制，使得开发人员可以更方便地编写事件处理逻辑，而无需考虑不同浏览器之间的差异。此外，合成事件还提供了一些额外的特性，例如阻止默认行为、停止事件传播等，可以通过合成事件对象的方法来实现。

需要注意的是，由于合成事件是 React 的封装，它并不是原生的 DOM 事件，因此有些特性可能与原生事件有所不同。但在大多数情况下，使用合成事件可以满足常见的事件处理需求，并提供更好的跨浏览器兼容性。
